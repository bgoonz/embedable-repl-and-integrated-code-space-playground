!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SpckEditor=t()}(this,function(){function e(e,t){if("string"==typeof e)this.element=document.querySelector(e);else{if(n=e,!("object"==typeof Node?n instanceof Node:n&&"object"==typeof n&&"number"==typeof n.nodeType&&"string"==typeof n.nodeName))throw new Error('Argument "element" must be a selector string or a HTMLElement.');this.element=e}var n;if(!((e=this.element)&&e.contentWindow&&e.contentWindow.postMessage))throw new Error('Argument "element" must be an IFRAME element.');this.contentWindow=e.contentWindow,this.origin=t||"https://embed.spck.io",this.handlers={}}return e.prototype={connect:function(e){var s=(e=e||{}).maxTries||20,a=e.interval||500,c=this.origin,u=this.contentWindow,f=this.handlers;return new Promise(function(o,t){function n(e){t(e)}var r=0,i=setInterval(function(){if(s<=r)return clearInterval(i),void n({id:1,message:"Connection to iframe window failed: maximum tries exceeded."});var e;r++;try{e=new MessageChannel}catch(e){return clearInterval(i),void n({id:2,message:"MessageChannel not supported."})}e.port1.onmessage=function(e){var t=e.data;if("connected"==t)clearInterval(i),o({tries:r});else if(t&&t.action){var n=t.action;f[n]&&f[n].apply(null,t.args)}},e.port1.onmessageerror=function(){n({id:3,message:"An error occurred in the transport of connection message."})};try{u.postMessage("connect",c,[e.port2])}catch(e){n({id:4,message:e.message||e.toString()})}},a)})},send:function(o){var r=this;return new Promise(function(t,e){var n=new MessageChannel;n.port1.onmessage=function(e){t(e.data)},n.port1.onmessageerror=function(){e()},r.contentWindow.postMessage(o,r.origin,[n.port2])})},on:function(e){for(var t in e)e.hasOwnProperty(t)&&(this.handlers[t]=e[t])},get:function(o){var r=this;return new Promise(function(t,e){var n=new MessageChannel;n.port1.onmessage=function(e){t(e.data)},n.port1.onmessageerror=function(){e()},r.contentWindow.postMessage(o,r.origin,[n.port2])})},getMode:function(){return this.get("mode")},getPosition:function(){return this.get("position")},getTabSize:function(){return this.get("tabSize")},getText:function(){return this.get("text")},getTheme:function(){return this.get("theme")}},e});